<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="../../../../apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../../../../apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../../../../apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../../../../apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="../../../../apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../../../../apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="../../../../apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../../../apple-touch-icon-152x152.png">
    <link rel="icon" type="image/png" href="../../../../favicon-196x196.png" sizes="196x196">
    <link rel="icon" type="image/png" href="../../../../favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="../../../../favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="../../../../favicon-16x16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="../../../../favicon-128.png" sizes="128x128">
    <meta name="application-name" content="Apache Camel">
    <meta property="og:title" content="Apache Camel helps you integrate over 300 different systems!">
    <meta property="og:site_name" content="Apache Camel">
    <meta property="og:url" content="https://camel.apache.org">
    <meta property="og:description" content="Camel is an open source integration framework that empowers you to quickly and easily integrate various systems consuming or producing data.">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://camel.apache.org/_/img/logo-d.svg">
    <link rel="manifest" href="../../../../site.webmanifest">
    <title>Routing multicast output after encountering partial failures - Apache Camel</title>
    <link rel="canonical" href="https://camel.apache.org/blog/2021/05/multicast-failure-routing/">
    
    
    <link rel="stylesheet" href="../../../../_/css/site-a192e92461.css">
</head>

<body class="article">
    <header class="header">
        <nav class="navbar">
            <div class="navbar-brand">
                <a class="nav-logo" href="../../../../" title="Apache Camel"></a>
                <div id="topbar-nav" class="navbar-menu">
                    <div class="navbar-end">
                        
                        <a class="navbar-item-section navbar-item navbar-topics" href="../../../../blog/">
                            <img alt="ブログ" src="../../../../_/img/blog.svg">
                            ブログ
                        </a>
                        
                        <a class="navbar-item-section navbar-item navbar-topics" href="../../../../docs/">
                            <img alt="ドキュメント" src="../../../../_/img/documentation.svg">
                            ドキュメント
                        </a>
                        
                        <a class="navbar-item-section navbar-item navbar-topics" href="../../../../community/">
                            <img alt="コミュニティ" src="../../../../_/img/community.svg">
                            コミュニティ
                        </a>
                        
                        <a class="navbar-item-section navbar-item navbar-topics" href="../../../../download/">
                            <img alt="ダウンロード" src="../../../../_/img/download.svg">
                            ダウンロード
                        </a>
                        
                    </div>
                </div>
                <div class="navbar-fill"></div>
                <div class="break-row"></div>
                <div class="navbar-search results-hidden">
                    <input id="search" class="search" placeholder="Search" autocomplete="off">
                    <img src= "/_/img/cancel.svg" alt="Clear" id="search-cancel">
                    <div id="search_results"></div>
                </div>
                <div class="navbar-tools">
                  <a rel="noopener noreferrer nofollow" href="https://github.com/apache/camel/" title="Collaborate on GitHub"><svg focusable="false" class="brand-icon"><use href="../../../../_/img/brand-logos.svg#github" /></svg></a>
                  <a rel="noopener noreferrer nofollow" href="https://camel.zulipchat.com" title="Chat on Zulip"><svg focusable="false" class="brand-icon"><use href="../../../../_/img/brand-logos.svg#zulip" /></svg></a>
                  <a rel="noopener noreferrer nofollow" href="https://twitter.com/ApacheCamel" title="Follow Apache Camel on Twitter"><svg focusable="false" class="brand-icon"><use href="../../../../_/img/brand-logos.svg#twitter" /></svg></a>
                </div>
                <button class="navbar-burger" data-target="topbar-nav" type="button" aria-label="Menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </nav>
    </header>
    <a id="top"></a>


<div class="body">
    <main role="main blog">
        <article class="blog doc">

    <header>
        
        <a class="category"
            href="../../../../categories/Usecases/">USECASES</a>
        
        <h1>Routing multicast output after encountering partial failures</h1>
    </header>
    <div class="post">
        <aside>
            <div class="summary">Routing multicast output after encountering partial failures</div>
            Posted on <time itemprop="published" datetime="2021-05-10"
                title="Monday, May 10, 2021">May 10, 2021</time>,
            by 
            
            <figure>
                <img src="https://avatars.githubusercontent.com/u/81697586?v=4" alt="Hokutor">
                <figcaption rel="author">Hokutor</figcaption>
            </figure>
            
            
            
            <figure>
                <img src="https://avatars.githubusercontent.com/u/5595781?v=4" alt="Reji Mathews">
                <figcaption rel="author">Reji Mathews</figcaption>
            </figure>
            
            

            <h4>Share this blog</h4>

            
            <a class="resp-sharing-button__link" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fcamel.apache.org%2fblog%2f2021%2f05%2fmulticast-failure-routing%2f" target="_blank" rel="noopener" aria-label="Share on Facebook">
                <div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" focusable="false"><path d="M18.77 7.46H14.5v-1.9c0-.9.6-1.1 1-1.1h3V.5h-4.33C10.24.5 9.5 3.44 9.5 5.32v2.15h-3v4h3v12h5v-12h3.85l.42-4z"/></svg>
                </div>
                </div>
            </a>

            
            <a class="resp-sharing-button__link" href="https://twitter.com/intent/tweet/?text=Routing%20multicast%20output%20after%20encountering%20partial%20failures&url=https%3a%2f%2fcamel.apache.org%2fblog%2f2021%2f05%2fmulticast-failure-routing%2f&hashtags=ApacheCamel" target="_blank" rel="noopener" aria-label="Share on Twitter">
                <div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" focusable="false"><path d="M23.44 4.83c-.8.37-1.5.38-2.22.02.93-.56.98-.96 1.32-2.02-.88.52-1.86.9-2.9 1.1-.82-.88-2-1.43-3.3-1.43-2.5 0-4.55 2.04-4.55 4.54 0 .36.03.7.1 1.04-3.77-.2-7.12-2-9.36-4.75-.4.67-.6 1.45-.6 2.3 0 1.56.8 2.95 2 3.77-.74-.03-1.44-.23-2.05-.57v.06c0 2.2 1.56 4.03 3.64 4.44-.67.2-1.37.2-2.06.08.58 1.8 2.26 3.12 4.25 3.16C5.78 18.1 3.37 18.74 1 18.46c2 1.3 4.4 2.04 6.97 2.04 8.35 0 12.92-6.92 12.92-12.93 0-.2 0-.4-.02-.6.9-.63 1.96-1.22 2.56-2.14z"/></svg>
                </div>
                </div>
            </a>

            
            <a class="resp-sharing-button__link" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fcamel.apache.org%2fblog%2f2021%2f05%2fmulticast-failure-routing%2f&title=Routing%20multicast%20output%20after%20encountering%20partial%20failures&summary=Routing%20multicast%20output%20after%20encountering%20partial%20failures&source=https%3A%2F%2Fcamel.apache.org" target="_blank" rel="noopener" aria-label="Share on LinkedIn" title="Share on LinkedIn">
                <div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" focusable="false"><path d="M6.5 21.5h-5v-13h5v13zM4 6.5C2.5 6.5 1.5 5.3 1.5 4s1-2.4 2.5-2.4c1.6 0 2.5 1 2.6 2.5 0 1.4-1 2.5-2.6 2.5zm11.5 6c-1 0-2 1-2 2v7h-5v-13h5V10s1.6-1.5 4-1.5c3 0 5 2.2 5 6.3v6.7h-5v-7c0-1-1-2-2-2z"/></svg>
                </div>
                </div>
            </a>

            <p>
                
                <a class="arrow prev" href="../../../../blog/2021/05/vscode-camel-release/"
                    title="Previous post: New release of VS Code Language Support for Apache Camel 0.0.32 and VS Code Tooling for Camel K 0.0.24">&#10094;</a>
                
                
                <a class="arrow next" href="../../../../blog/2021/05/new-camel-k-logging-features/"
                    title="Next post: New Camel K Logging Features">&#10095;</a>
                
            </p>
        </aside>
        <div class="post-content">
            
            
            

<h2 id="problem-description">Problem description</h2>

<p>Multicast is a powerful EIP which supports parallel execution paths in asynchronous manner. There are various ways a Camel user can configure a multicast EIP. Check out the extensive documentation <a href="../../../../components/latest/eips/multicast-eip.html">here</a>
1. One can configure to execute all the child paths independently and continue routing the last reply as the outgoing message (default behavior unless you provide an aggregation strategy)
2. Additionally, you can plug in an implementation of a <a href="https://github.com/apache/camel/blob/main/core/camel-api/src/main/java/org/apache/camel/AggregationStrategy.java" rel="nofollow noreferrer">Camel aggregation strategy</a> with user-defined logic to aggregate the output from each of those child paths before continuing further downstream routing.</p>

<p>For the use case discussed below, the requirement is to aggregate the computed results from all child paths before it gets routed to the downstream processors in the flow. The idea is to keep routing the aggregated results if at least one child route completes successfully without an exception. We also want to stop routing further if all the child exchanges experienced failures.</p>

<h2 id="use-case">Use case</h2>

<p>Check out the following Camel routes</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Override</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">configure</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
    onException<span style="color:#f92672">(</span>Exception<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">.</span><span style="color:#a6e22e">useOriginalMessage</span><span style="color:#f92672">()</span>
        <span style="color:#f92672">.</span><span style="color:#a6e22e">handled</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">.</span><span style="color:#a6e22e">log</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Exception handler invoked&#34;</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">.</span><span style="color:#a6e22e">transform</span><span style="color:#f92672">().</span><span style="color:#a6e22e">constant</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;{\&#34;data\&#34; : \&#34;err\&#34;}&#34;</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">.</span><span style="color:#a6e22e">end</span><span style="color:#f92672">();</span>

    from<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;jetty:http://localhost:8081/myapi?httpMethodRestrict=GET&#34;</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">.</span><span style="color:#a6e22e">log</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;received request&#34;</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">.</span><span style="color:#a6e22e">log</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Entering multicast&#34;</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">.</span><span style="color:#a6e22e">multicast</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> SimpleFlowMergeAggregator<span style="color:#f92672">())</span>
        <span style="color:#f92672">.</span><span style="color:#a6e22e">parallelProcessing</span><span style="color:#f92672">().</span><span style="color:#a6e22e">to</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;direct:A&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;direct:B&#34;</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">.</span><span style="color:#a6e22e">end</span><span style="color:#f92672">()</span>
        <span style="color:#f92672">.</span><span style="color:#a6e22e">log</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Aggregated results ${body}&#34;</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">.</span><span style="color:#a6e22e">log</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Another log&#34;</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">.</span><span style="color:#a6e22e">transform</span><span style="color:#f92672">(</span>simple<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;{\&#34;result\&#34; : \&#34;success\&#34;}&#34;</span><span style="color:#f92672">))</span>
        <span style="color:#f92672">.</span><span style="color:#a6e22e">end</span><span style="color:#f92672">();</span>

    from<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;direct:A&#34;</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">.</span><span style="color:#a6e22e">log</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Executing PATH_1 - exception path&#34;</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">.</span><span style="color:#a6e22e">transform</span><span style="color:#f92672">(</span>constant<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;DATA_FROM_PATH_1&#34;</span><span style="color:#f92672">))</span>
        <span style="color:#f92672">.</span><span style="color:#a6e22e">log</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Starting exception throw&#34;</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">.</span><span style="color:#a6e22e">throwException</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Exception<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;USER INITIATED EXCEPTION&#34;</span><span style="color:#f92672">))</span>
        <span style="color:#f92672">.</span><span style="color:#a6e22e">log</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;PATH_1&#34;</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">.</span><span style="color:#a6e22e">end</span><span style="color:#f92672">();</span>

    from<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;direct:B&#34;</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">.</span><span style="color:#a6e22e">log</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Executing PATH_2 - success path&#34;</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">.</span><span style="color:#a6e22e">delayer</span><span style="color:#f92672">(</span>1000<span style="color:#f92672">)</span>
        <span style="color:#f92672">.</span><span style="color:#a6e22e">transform</span><span style="color:#f92672">(</span>constant<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;DATA_FROM_PATH_2&#34;</span><span style="color:#f92672">))</span>
        <span style="color:#f92672">.</span><span style="color:#a6e22e">log</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;PATH_2&#34;</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">.</span><span style="color:#a6e22e">end</span><span style="color:#f92672">();</span>
<span style="color:#f92672">}</span></code></pre></div>
<p>Following strategy aggregates the output of each multicast child route as a java list</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SimpleFlowMergeAggregator</span> <span style="color:#66d9ef">implements</span> AggregationStrategy <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> Logger LOGGER <span style="color:#f92672">=</span> LoggerFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">getLogger</span><span style="color:#f92672">(</span>SimpleFlowMergeAggregator<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">());</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> Exchange <span style="color:#a6e22e">aggregate</span><span style="color:#f92672">(</span>Exchange oldExchange<span style="color:#f92672">,</span> Exchange newExchange<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        LOGGER<span style="color:#f92672">.</span><span style="color:#a6e22e">info</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Inside aggregator &#34;</span> <span style="color:#f92672">+</span> newExchange<span style="color:#f92672">.</span><span style="color:#a6e22e">getIn</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getBody</span><span style="color:#f92672">());</span>
        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>oldExchange <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            String data <span style="color:#f92672">=</span> newExchange<span style="color:#f92672">.</span><span style="color:#a6e22e">getIn</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getBody</span><span style="color:#f92672">(</span>String<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
            List<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> aggregatedDataList <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;();</span>
            aggregatedDataList<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>data<span style="color:#f92672">);</span>
            newExchange<span style="color:#f92672">.</span><span style="color:#a6e22e">getIn</span><span style="color:#f92672">().</span><span style="color:#a6e22e">setBody</span><span style="color:#f92672">(</span>aggregatedDataList<span style="color:#f92672">);</span>
            <span style="color:#66d9ef">return</span> newExchange<span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>

        List<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> oldData <span style="color:#f92672">=</span> oldExchange<span style="color:#f92672">.</span><span style="color:#a6e22e">getIn</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getBody</span><span style="color:#f92672">(</span>List<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
        oldData<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>newExchange<span style="color:#f92672">.</span><span style="color:#a6e22e">getIn</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getBody</span><span style="color:#f92672">(</span>String<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">));</span>
        oldExchange<span style="color:#f92672">.</span><span style="color:#a6e22e">getIn</span><span style="color:#f92672">().</span><span style="color:#a6e22e">setBody</span><span style="color:#f92672">(</span>oldData<span style="color:#f92672">);</span>

        <span style="color:#66d9ef">return</span> oldExchange<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span></code></pre></div>
<p>On executing the same, we see following logs</p>
<pre><code class="language-log" data-lang="log">2021-05-06 12:43:18.565  INFO 13956 --- [qtp916897446-42] route1                                   : received request
2021-05-06 12:43:18.566  INFO 13956 --- [qtp916897446-42] route1                                   : Entering multicast
2021-05-06 12:43:18.575  INFO 13956 --- [ #4 - Multicast] route2                                   : Executing PATH_1 - exception path
2021-05-06 12:43:18.575  INFO 13956 --- [ #4 - Multicast] route2                                   : Starting exception throw
2021-05-06 12:43:18.578  INFO 13956 --- [ #4 - Multicast] route2                                   : Exception handler invoked
2021-05-06 12:43:18.579  INFO 13956 --- [ #4 - Multicast] c.e.d.m.SimpleFlowMergeAggregator        : Inside aggregator {&#34;data&#34; : &#34;err&#34;}
2021-05-06 12:43:19.575  INFO 13956 --- [ #3 - Multicast] route3                                   : Executing PATH_2 - success path
2021-05-06 12:43:21.576  INFO 13956 --- [ #3 - Multicast] route3                                   : PATH_2
2021-05-06 12:43:21.576  INFO 13956 --- [ #3 - Multicast] c.e.d.m.SimpleFlowMergeAggregator        : Inside aggregator DATA_FROM_PATH_2</code></pre>
<h2 id="what-could-take-you-by-a-surprise">What could take you by a surprise?</h2>

<p>When the multicast completes aggregating exchanges from child branches, one might intermittently note that it stops routing the remaining processors (those two additional log and a transform steps in the above example). On execution tracing exercise, you will notice this happens in a special scenario when the very first exchange which arrives in the aggregator (from the first completed child branch) had encountered an exception during its course or/and was handled via <code>onException</code> flows. On the flip side, if the first exchange was successful and even though all the remaining ones experienced a failure, it continued routing the remaining processors/steps.</p>

<h2 id="analysis">Analysis</h2>

<p>To understand this better let&rsquo;s deep dive into the open source codebase. Check out <code>PipelineProcessor.java</code> (part of <code>camel-core-processors</code> module). The following section of code in the class <code>Pipeline</code> evaluates after every user processor (user added steps in a Camel flow) on whether it should continue routing to the next processor.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Override</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">boolean</span> stop <span style="color:#f92672">=</span> exchange<span style="color:#f92672">.</span><span style="color:#a6e22e">isRouteStop</span><span style="color:#f92672">();</span>
    <span style="color:#66d9ef">int</span> num <span style="color:#f92672">=</span> index<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">boolean</span> more <span style="color:#f92672">=</span> num <span style="color:#f92672">&lt;</span> size<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">boolean</span> first <span style="color:#f92672">=</span> num <span style="color:#f92672">==</span> 0<span style="color:#f92672">;</span>

    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>stop <span style="color:#f92672">&amp;&amp;</span> more <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">(</span>first <span style="color:#f92672">||</span> continueProcessing<span style="color:#f92672">(</span>exchange<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;so breaking out of pipeline&#34;</span><span style="color:#f92672">,</span> LOG<span style="color:#f92672">)))</span> <span style="color:#f92672">{</span>

        <span style="color:#75715e">// prepare for next run
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>exchange<span style="color:#f92672">.</span><span style="color:#a6e22e">hasOut</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
            exchange<span style="color:#f92672">.</span><span style="color:#a6e22e">setIn</span><span style="color:#f92672">(</span>exchange<span style="color:#f92672">.</span><span style="color:#a6e22e">getOut</span><span style="color:#f92672">());</span>
            exchange<span style="color:#f92672">.</span><span style="color:#a6e22e">setOut</span><span style="color:#f92672">(</span><span style="color:#66d9ef">null</span><span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>

        <span style="color:#75715e">// get the next processor
</span><span style="color:#75715e"></span>        AsyncProcessor processor <span style="color:#f92672">=</span> processors<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>index<span style="color:#f92672">++);</span>

        processor<span style="color:#f92672">.</span><span style="color:#a6e22e">process</span><span style="color:#f92672">(</span>exchange<span style="color:#f92672">,</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// copyResults is needed in case MEP is OUT and the message is not an OUT message
</span><span style="color:#75715e"></span>        ExchangeHelper<span style="color:#f92672">.</span><span style="color:#a6e22e">copyResults</span><span style="color:#f92672">(</span>exchange<span style="color:#f92672">,</span> exchange<span style="color:#f92672">);</span>

        <span style="color:#75715e">// logging nextExchange as it contains the exchange that might have altered the payload and since
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// we are logging the completion if will be confusing if we log the original instead
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// we could also consider logging the original and the nextExchange then we have *before* and *after* snapshots
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>LOG<span style="color:#f92672">.</span><span style="color:#a6e22e">isTraceEnabled</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
            LOG<span style="color:#f92672">.</span><span style="color:#a6e22e">trace</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Processing complete for exchangeId: {} &gt;&gt;&gt; {}&#34;</span><span style="color:#f92672">,</span> exchange<span style="color:#f92672">.</span><span style="color:#a6e22e">getExchangeId</span><span style="color:#f92672">(),</span> exchange<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>

        AsyncCallback cb <span style="color:#f92672">=</span> callback<span style="color:#f92672">;</span>
        taskFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">release</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">);</span>
        reactiveExecutor<span style="color:#f92672">.</span><span style="color:#a6e22e">schedule</span><span style="color:#f92672">(</span>cb<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span></code></pre></div>
<p>This decision is made inside the if block</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>stop <span style="color:#f92672">&amp;&amp;</span> more <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">(</span>first <span style="color:#f92672">||</span> continueProcessing<span style="color:#f92672">(</span>exchange<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;so breaking out of pipeline&#34;</span><span style="color:#f92672">,</span> LOG<span style="color:#f92672">)))</span></code></pre></div>
<p>The Pipeline stops routing to next processor under following 3 conditions
If previous processors have marked route stop on the exchange object.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">boolean</span> stop <span style="color:#f92672">=</span> exchange<span style="color:#f92672">.</span><span style="color:#a6e22e">isRouteStop</span><span style="color:#f92672">();</span></code></pre></div>
<p>There are no more processors in the pipeline</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">boolean</span> more <span style="color:#f92672">=</span> num <span style="color:#f92672">&lt;</span> size<span style="color:#f92672">;</span></code></pre></div>
<p><code>PipelineHelper.continueProcessing()</code> evaluates to <code>false</code> when an exchange encounters any java exception during the course of routing and gets handled via exception handling routines. Refer the implementation code below</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PipelineHelper</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">continueProcessing</span><span style="color:#f92672">(</span>Exchange exchange<span style="color:#f92672">,</span> String message<span style="color:#f92672">,</span> Logger log<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        ExtendedExchange ee <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>ExtendedExchange<span style="color:#f92672">)</span> exchange<span style="color:#f92672">;</span>
        <span style="color:#66d9ef">boolean</span> stop <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span><span style="color:#a6e22e">isFailed</span><span style="color:#f92672">()</span> <span style="color:#f92672">||</span> ee<span style="color:#f92672">.</span><span style="color:#a6e22e">isRollbackOnly</span><span style="color:#f92672">()</span> <span style="color:#f92672">||</span> ee<span style="color:#f92672">.</span><span style="color:#a6e22e">isRollbackOnlyLast</span><span style="color:#f92672">()</span>
                <span style="color:#f92672">||</span> <span style="color:#f92672">(</span>ee<span style="color:#f92672">.</span><span style="color:#a6e22e">isErrorHandlerHandledSet</span><span style="color:#f92672">()</span> <span style="color:#f92672">&amp;&amp;</span> ee<span style="color:#f92672">.</span><span style="color:#a6e22e">isErrorHandlerHandled</span><span style="color:#f92672">());</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>stop<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>log<span style="color:#f92672">.</span><span style="color:#a6e22e">isDebugEnabled</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
                StringBuilder sb <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> StringBuilder<span style="color:#f92672">();</span>
                sb<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Message exchange has failed: &#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span>message<span style="color:#f92672">).</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34; for exchange: &#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span>exchange<span style="color:#f92672">);</span>
                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>exchange<span style="color:#f92672">.</span><span style="color:#a6e22e">isRollbackOnly</span><span style="color:#f92672">()</span> <span style="color:#f92672">||</span> exchange<span style="color:#f92672">.</span><span style="color:#a6e22e">isRollbackOnlyLast</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
                    sb<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34; Marked as rollback only.&#34;</span><span style="color:#f92672">);</span>
                <span style="color:#f92672">}</span>
                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>exchange<span style="color:#f92672">.</span><span style="color:#a6e22e">getException</span><span style="color:#f92672">()</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    sb<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34; Exception: &#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span>exchange<span style="color:#f92672">.</span><span style="color:#a6e22e">getException</span><span style="color:#f92672">());</span>
                <span style="color:#f92672">}</span>
                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>ee<span style="color:#f92672">.</span><span style="color:#a6e22e">isErrorHandlerHandledSet</span><span style="color:#f92672">()</span> <span style="color:#f92672">&amp;&amp;</span> ee<span style="color:#f92672">.</span><span style="color:#a6e22e">isErrorHandlerHandled</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
                    sb<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34; Handled by the error handler.&#34;</span><span style="color:#f92672">);</span>
                <span style="color:#f92672">}</span>
                log<span style="color:#f92672">.</span><span style="color:#a6e22e">debug</span><span style="color:#f92672">(</span>sb<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">());</span>
            <span style="color:#f92672">}</span>

            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>ee<span style="color:#f92672">.</span><span style="color:#a6e22e">isRouteStop</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>log<span style="color:#f92672">.</span><span style="color:#a6e22e">isDebugEnabled</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
                log<span style="color:#f92672">.</span><span style="color:#a6e22e">debug</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;ExchangeId: {} is marked to stop routing: {}&#34;</span><span style="color:#f92672">,</span> exchange<span style="color:#f92672">.</span><span style="color:#a6e22e">getExchangeId</span><span style="color:#f92672">(),</span> exchange<span style="color:#f92672">);</span>
            <span style="color:#f92672">}</span>
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>

        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

<span style="color:#f92672">}</span></code></pre></div>
<p>Well, now let&rsquo;s re-visit our use case. What if you still want to continue routing?</p>

<p>From our above aggregator, you will notice that the very first exchange which arrives in aggregator becomes the base exchange on which the aggregator continues to pile up body content (with incoming results from other child routes). In fact, a lot of Camel users follow this pattern of writing an aggregator strategy. Unfortunately, if done this way, the state variables set on the Exchange object during exception handling get carried forward to the next evaluation point in Pipeline and qualify to stop routing.</p>

<h2 id="solution">Solution</h2>

<p>There are many ways a user could neutralize the states set by the exception handling framework. However, for the scope of this article, we chose the following strategy.
- If the first child route exchange never encountered an exception, then continue processing the rest of the aggregation cycle as usual.
- If the first child encountered an exception, then introspect the incoming exchanges for success case. If found, shift the base to be the first successful exchange and move the aggregated results on to it and continue the rest of the aggregation lifecycle as usual.</p>

<p>Updated <code>AggregationStrategy</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SimpleFlowMergeAggregator</span> <span style="color:#66d9ef">implements</span> AggregationStrategy <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> Logger LOGGER <span style="color:#f92672">=</span> LoggerFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">getLogger</span><span style="color:#f92672">(</span>SimpleFlowMergeAggregator<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">());</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> Exchange <span style="color:#a6e22e">aggregate</span><span style="color:#f92672">(</span>Exchange oldExchange<span style="color:#f92672">,</span> Exchange newExchange<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        LOGGER<span style="color:#f92672">.</span><span style="color:#a6e22e">info</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Inside aggregator &#34;</span> <span style="color:#f92672">+</span> newExchange<span style="color:#f92672">.</span><span style="color:#a6e22e">getIn</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getBody</span><span style="color:#f92672">());</span>
        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>oldExchange <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            String data <span style="color:#f92672">=</span> newExchange<span style="color:#f92672">.</span><span style="color:#a6e22e">getIn</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getBody</span><span style="color:#f92672">(</span>String<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
            List<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> aggregatedDataList <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;();</span>
            aggregatedDataList<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>data<span style="color:#f92672">);</span>
            newExchange<span style="color:#f92672">.</span><span style="color:#a6e22e">getIn</span><span style="color:#f92672">().</span><span style="color:#a6e22e">setBody</span><span style="color:#f92672">(</span>aggregatedDataList<span style="color:#f92672">);</span>
            <span style="color:#66d9ef">return</span> newExchange<span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>

        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>hadException<span style="color:#f92672">(</span>oldExchange<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">if</span><span style="color:#f92672">(!</span>hadException<span style="color:#f92672">(</span>newExchange<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
                <span style="color:#75715e">// aggregate and swap the base
</span><span style="color:#75715e"></span>                LOGGER<span style="color:#f92672">.</span><span style="color:#a6e22e">info</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Found new exchange with success. swapping the base exchange&#34;</span><span style="color:#f92672">);</span>
                List<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> oldData <span style="color:#f92672">=</span> oldExchange<span style="color:#f92672">.</span><span style="color:#a6e22e">getIn</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getBody</span><span style="color:#f92672">(</span>List<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
                oldData<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>newExchange<span style="color:#f92672">.</span><span style="color:#a6e22e">getIn</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getBody</span><span style="color:#f92672">(</span>String<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">));</span>
                newExchange<span style="color:#f92672">.</span><span style="color:#a6e22e">getIn</span><span style="color:#f92672">().</span><span style="color:#a6e22e">setBody</span><span style="color:#f92672">(</span>oldData<span style="color:#f92672">);</span> <span style="color:#75715e">// swapped the base here
</span><span style="color:#75715e"></span>                <span style="color:#66d9ef">return</span> newExchange<span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>

        List<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> oldData <span style="color:#f92672">=</span> oldExchange<span style="color:#f92672">.</span><span style="color:#a6e22e">getIn</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getBody</span><span style="color:#f92672">(</span>List<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
        oldData<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>newExchange<span style="color:#f92672">.</span><span style="color:#a6e22e">getIn</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getBody</span><span style="color:#f92672">(</span>String<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">));</span>
        oldExchange<span style="color:#f92672">.</span><span style="color:#a6e22e">getIn</span><span style="color:#f92672">().</span><span style="color:#a6e22e">setBody</span><span style="color:#f92672">(</span>oldData<span style="color:#f92672">);</span>

        <span style="color:#66d9ef">return</span> oldExchange<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>


    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">hadException</span><span style="color:#f92672">(</span>Exchange exchange<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>

        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>exchange<span style="color:#f92672">.</span><span style="color:#a6e22e">isFailed</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>

        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>exchange<span style="color:#f92672">.</span><span style="color:#a6e22e">isRollbackOnly</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>

        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>exchange<span style="color:#f92672">.</span><span style="color:#a6e22e">isRollbackOnlyLast</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>

        <span style="color:#66d9ef">if</span><span style="color:#f92672">(((</span>ExtendedExchange<span style="color:#f92672">)</span>exchange<span style="color:#f92672">).</span><span style="color:#a6e22e">isErrorHandlerHandledSet</span><span style="color:#f92672">()</span>
                <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">((</span>ExtendedExchange<span style="color:#f92672">)</span>exchange<span style="color:#f92672">).</span><span style="color:#a6e22e">isErrorHandlerHandled</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>

        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span></code></pre></div><pre><code class="language-log" data-lang="log">2021-05-06 12:46:19.122  INFO 2576 --- [qtp174245837-45] route1                                   : received request
2021-05-06 12:46:19.123  INFO 2576 --- [qtp174245837-45] route1                                   : Entering multicast
2021-05-06 12:46:19.130  INFO 2576 --- [ #3 - Multicast] route2                                   : Executing PATH_1 - exception path
2021-05-06 12:46:19.130  INFO 2576 --- [ #3 - Multicast] route2                                   : Starting exception throw
2021-05-06 12:46:19.134  INFO 2576 --- [ #3 - Multicast] route2                                   : Exception handler invoked
2021-05-06 12:46:19.135  INFO 2576 --- [ #3 - Multicast] c.e.d.m.SimpleFlowMergeAggregator        : Inside aggregator {&#34;data&#34; : &#34;err&#34;}
2021-05-06 12:46:20.130  INFO 2576 --- [ #4 - Multicast] route3                                   : Executing PATH_2 - success path
2021-05-06 12:46:22.132  INFO 2576 --- [ #4 - Multicast] route3                                   : PATH_2
2021-05-06 12:46:22.132  INFO 2576 --- [ #4 - Multicast] c.e.d.m.SimpleFlowMergeAggregator        : Inside aggregator DATA_FROM_PATH_2
2021-05-06 12:46:22.132  INFO 2576 --- [ #4 - Multicast] c.e.d.m.SimpleFlowMergeAggregator        : Found new exchange with success. swapping the base exchange
2021-05-06 12:46:22.133  INFO 2576 --- [ #4 - Multicast] route1                                   : Aggregated results {&#34;data&#34; : &#34;err&#34;},DATA_FROM_PATH_2
2021-05-06 12:46:22.133  INFO 2576 --- [ #4 - Multicast] route1                                   : Another log</code></pre>
<p>With the new aggregator implementation, you can now see the exchange getting routed down to the remaining processors.</p>

<p>Hope this article helps users who encounter this issue.</p>

            <div class="related">
            
            </div>
        </div>
    </div>

</article>

    </main>
</div>

    <div class="footer-tools">
        
            <a title="Improve this document, receive free virtual hugs &hearts;" href="https://github.com/apache/camel-website/edit/main/content/blog/2021/05/multicast-failure-routing/index.md">このページを編集する</a>
        
        <a href="#top" title="Reach the top of the page">トップへ戻る</a>
    </div>
    <footer>
        <div class="footer">
            <figure class="logo">
                <img class="logo" src="../../../../_/img/logo-d.svg" alt="Apache Camel Logo"
                    aria-label="white silhouette of a camel in front of a sand dune">
            </figure>
            <input id="footer-toggle-overview" type="checkbox" title="Show/Hide Overview section" />
            <dl>
                <dt><label for="footer-toggle-overview">概要</label><label for="footer-toggle-overview">&#65291;</label></dt>
                <dd><a href="../../../../blog/">ブログ</a></dd>
                <dd><a href="../../../../docs/">ドキュメント</a></dd>
                <dd><a href="../../../../community/support/">コミュニティ</a></dd>
                <dd><a href="../../../../download/">ダウンロード</a></dd>
            </dl>
            <input id="footer-toggle-documentation" type="checkbox" title="Show/Hide Documentation section" />
            <dl>
                <dt><label for="footer-toggle-documentation">ドキュメント</label><label for="footer-toggle-documentation">&#65291;</label></dt>
                <dd><a href="../../../../manual/latest/">ユーザーマニュアル</a></dd>
                <dd><a href="../../../../components/latest/index.html">コンポーネント</a></dd>
                <dd><a href="../../../../camel-k/latest/">Camel-K</a></dd>
                <dd><a href="../../../../camel-kafka-connector/latest/">Camel Kafka Connector</a></dd>
                <dd><a href="../../../../camel-quarkus/latest/">Camel Quarkus</a></dd>
                <dd><a href="../../../../camel-spring-boot/latest/">Camel Spring Boot</a></dd>
                <dd><a href="../../../../camel-karaf/latest/">Camel Karaf</a></dd>
                <dd><a href="../../../../manual/latest/faq/index.html">FAQ</a></dd>
            </dl>
            <input id="footer-toggle-community" type="checkbox" title="Show/Hide Community section" />
            <dl>
                <dt><label for="footer-toggle-community">コミュニティ</label><label for="footer-toggle-community">&#65291;</label></dt>
                <dd><a href="../../../../community/support/">サポート</a></dd>
                <dd><a href="../../../../community/contributing/">貢献する</a></dd>
                <dd><a href="../../../../community/mailing-list">メーリングリスト</a></dd>
                <dd><a href="../../../../community/user-stories/">ユーザー事例</a></dd>
                <dd><a href="../../../../community/articles/">記事</a></dd>
                <dd><a href="../../../../community/books/">書籍</a></dd>
                <dd><a href="../../../../community/team/">開発チーム</a></dd>
            </dl>
            <input id="footer-toggle-about" type="checkbox" title="Show/Hide Acknowledgements section" />
            <dl>
                <dt><label for="footer-toggle-about">このプロジェクトについて</label><label for="footer-toggle-about">&#65291;</label></dt>
                <dd><a href="../../../../acknowledgments/">謝辞</a></dd>
                <dd><a target="_blank" rel="noopener noreferrer nofollow" href="https://www.apache.org/events/current-event.html" title="Apache Events">Apacheイベント</a></dd>
                <dd><a target="_blank" rel="noopener noreferrer nofollow" href="https://www.apache.org/licenses/" title="License">ライセンス</a></dd>
                <dd><a target="_blank" rel="noopener noreferrer nofollow" href="https://www.apache.org/security/" title="Security">セキュリティ</a></dd>
                <dd><a target="_blank" rel="noopener noreferrer nofollow" href="https://www.apache.org/foundation/sponsorship.html" title="Sponsorship">スポンサーについて</a></dd>
                <dd><a target="_blank" rel="noopener noreferrer nofollow" href="https://www.apache.org/foundation/thanks.html" title="Thanks">協賛組織</a></dd>
            </dl>
            <p class="remark">
                &copy; 2004-2021 <a href="https://apache.org">Apache Software Foundation</a>.<br>
                Apache Camel、Camel、Apache、Apacheフェザーのロゴ、およびApache Camelプロジェクトのロゴは、Apache Software Foundationの商標です。
                その他記載されているマークは、それぞれの所有者の商標または登録商標である可能性があります。
                
            </p>
            <div class="resources">
                <div class="context">
                    <a href="../../../../privacy-policy/">プライバシーポリシー</a>
                </div>
                <div class="context">
                    <a target="_blank" rel="noopener noreferrer nofollow" href="https://www.apache.org/foundation/policies/conduct">行動規範</a>
                </div>
                <div class="context">
                    <a href="../../../../sitemap/">サイトマップ</a>
                </div>
            </div>
            <div class="footer-icons">
                <a rel="noopener noreferrer nofollow" href="https://github.com/apache/camel/" title="Collaborate on GitHub"><svg class="brand-icon" focusable="false"><use href="../../../../_/img/brand-logos.svg#github" /></svg></a>
                <a rel="noopener noreferrer nofollow" href="https://camel.zulipchat.com" title="Chat on Zulip"><svg class="brand-icon" focusable="false"><use href="../../../../_/img/brand-logos.svg#zulip" /></svg></a>
                <a rel="noopener noreferrer nofollow" href="https://twitter.com/ApacheCamel" title="Follow Apache Camel on Twitter"><svg class="brand-icon" focusable="false"><use href="../../../../_/img/brand-logos.svg#twitter" /></svg></a>
            </div>
        </div>
    </footer>
    <script src="../../../../_/js/vendor/algoliasearch-8fe81df376.js"></script>
    <script src="../../../../_/js/site-0d18f68ee9.js"></script>
    <script async src="../../../../_/js/vendor/highlight-a988c6fdd9.js"></script>
    <script async src="../../../../_/js/vendor/svg4everybody-195d47ce7d.js"></script>
    <script type='application/ld+json'>
  {
    "@context": "http://schema.org",
    "@type": "Organization",
    "name": "Apache Camel",
    "url": "https:\/\/camel.apache.org\/"
    , "sameAs": ["https://twitter.com/ApacheCamel"]
    , "logo": "https:\/\/camel.apache.org\/_\/img\/logo-d.svg"
    , "description": "Apache Camel ™ is a versatile open-source integration framework based on known Enterprise Integration Patterns. Camel empowers you to define routing and mediation rules in a variety of domain-specific languages, including a Java-based Fluent API, Spring or Blueprint XML Configuration files, and a Scala DSL." 
  }
</script>






  
  
  
    
  

  
  
  
    
  

  
  
  
    
  

  
  
  
    
  

  
  
  


<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position":  1 ,
        "item": {
          "@id": "https://camel.apache.org/",
          "name": "Apache Camel"
        }
    },{
        "@type": "ListItem",
        "position":  2 ,
        "item": {
          "@id": "https://camel.apache.org/blog/",
          "name": "blog"
        }
    },{
        "@type": "ListItem",
        "position":  3 ,
        "item": {
          "@id": "https://camel.apache.org/blog/2021/",
          "name": "2021"
        }
    },{
        "@type": "ListItem",
        "position":  4 ,
        "item": {
          "@id": "https://camel.apache.org/blog/2021/05/",
          "name": "05"
        }
    },{
        "@type": "ListItem",
        "position":  5 ,
        "item": {
          "@id": "https://camel.apache.org/blog/2021/05/multicast-failure-routing/",
          "name": "multicast-failure-routing"
        }
    }]
}
</script>




</body>
</html>

